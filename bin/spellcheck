#!/usr/local/plan9/bin/rc
# Spell check with Acme friendly output

lang=en_GB    # British English
mode=t        # TeX mode

if (~ $#* 0) {
	if (~ $#samfile 0) {
		echo 'Usage: spellcheck [FILE]'
		exit 1
	}
	if not
		file=$samfile
}
if not
	file=$1

misspelt=`{aspell pipe -l $lang -$mode < $file | awk '/[a-zA-Z]+ [0-9]+ [0-9]+/{ print $2 }'}

for (word in $misspelt) {
	grep -oub $word $file | awk -v 'x='$file -F: '{ print x":#"$1" "$2 }'
}
